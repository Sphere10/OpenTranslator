@{
	ViewBag.Title = "Open Translation";
}


<div class="container-fluid">
	<div class="row">
		<div class="col-md-12">
			@Html.InitCrudPopupsForGrid("OriginalTextGrid", "Admin", 470, 1000, "String")

			@*<center><h2>Open Language Translation - User Screen </h2></center>*@

			<style>
				.awe-ajaxcheckboxlist-field li {
					display: inline-block;
				}
			</style>

			@(Html.Awe().InitPopupForm()
				.Name("Login")
				.Url(Url.Action("Create", "Login"))
				.Title("Admin Login")
				.Width(100)
				.Success("RedirectToAdmin"))

			@*<input type="button" value="Login" onclick="awe.open('Login')" class="awe-btn mbtn" style="float:right" />*@

			<script>
				$(function () {
					$('#chkColumns').change(function () {
						var val = $('#chkColumns').val();
						var clearSession = false;
						if (!val) {
							val = "[]";
							var clearSession = true;
						}
						$('#OriginalTextGrid').data('api').load({ oparams: { selectedColumns: JSON.parse(val), choosingColumns: true, clearsession: clearSession } });
					});
				});

			</script>
			<div id="myDiv" data-value="@Request.RequestContext.HttpContext.Session["SelectedColumns"]"></div>
			@(Html.Awe().InitPopupForm()
				.Name("EditTranslation")
				.Url(Url.Action("Edit", "User"))
				.Title("Edit Translation")
				.Success("UpdateGrid"))

			<div class="bar">

				@Html.Awe().AjaxCheckboxList("chkColumns").Url(Url.Action("GetColumnsItems", "Admin")).Load(true)
			</div>
			@(Html.Awe().Grid("OriginalTextGrid")
			.Mod(o => o.ColumnsSelector().PageSize().PageInfo().Loading().AutoMiniPager())
			.Url(Url.Action("OriginalTextGridGetItems", "Admin"))
			.Parameter("UserType", "User")
			.Persistence(Persistence.Session)
			.ColumnsPersistence(Persistence.Session)
			.Groupable(false)
			.Columns())
		</div>
	</div>
</div>



<br /><br />
<script>
	function disableBack() {
		window.location.hash = "User";
		window.location.hash = "Again-No-back-button";//again because google chrome don't insert first hash into history
		window.onhashchange = function () { window.location.hash = ""; }
		//session();
	}
	function session()
	{
		$.ajax({
			url: '@Url.Action("getSession", "User")',
			type: 'POST',
			dataType: 'json',
			cache: false,
			success: function (data) {
				if (data.selectedColumns == null)
					@Html.Awe().OpenPopup("Login");
			},
			error: function (data) {
			}
    });
	};

	window.onload = disableBack();
	window.onpageshow = function (evt) { if (evt.persisted) disableBack() }

	function RedirectToAdmin() {
		var url = '@Url.Action("Index", "Admin")';
		window.location = url;
	}
	function UpdateGrid(result, popup) {
		$('#OriginalTextGrid').data('api').load({});
	}
	function getVal(i, columnname) {
		return function (model) {
			var div = "";
			var a = model.Values[i];
			if (a != "")
				div = '<span style="width:90% ; overflow: hidden;float: left; text-overflow: ellipsis;">' + a + '</span><span style="cursor: pointer; display: inline-flex; float: right;" class="ico-edit" onclick="awe.open(\'EditTranslation\', { params: { TextId: \'' + model.TextId + '\', code : \'' + columnname + '\' } })" ></span>';
			else
				div = '<span style="cursor: pointer; display: inline-flex; float: right;" class="ico-edit" onclick="awe.open(\'EditTranslation\', { params: { TextId: \'' + model.TextId + '\', code : \'' + columnname + '\' } })" ></span>';
			return div;
		};
	}
	
</script>



